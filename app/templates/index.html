<!-- templates/index.html -->
{% extends "base.html" %}

{% block title %}داشبورد اصلی - سیستم تحلیل هوشمند CRM{% endblock %}

{% block page_header %}
<div class="mb-8 fade-in">
    <h2 class="text-3xl font-bold text-gray-800">داشبورد اصلی</h2>
    <p class="text-gray-600 mt-2">نمای کلی از فعالیت‌ها و تحلیل‌های سیستم</p>
</div>
{% endblock %}

{% block content %}
<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 fade-in" id="overview-stats">
    <!-- توسط JavaScript پر می‌شود -->
</div>

<!-- Charts Section -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8 fade-in">
    <!-- Trend Chart -->
    <div class="pro-card rounded-lg p-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">روند هفتگی تحلیل‌ها</h3>
            <div class="icon-box info w-10 h-10">
                <i class="fas fa-chart-line"></i>
            </div>
        </div>
        <div style="height: 250px;">
            <canvas id="trendChart"></canvas>
        </div>
    </div>

    <!-- Score Distribution Chart -->
    <div class="pro-card rounded-lg p-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">توزیع امتیازها</h3>
            <div class="icon-box success w-10 h-10">
                <i class="fas fa-chart-pie"></i>
            </div>
        </div>
        <div style="height: 250px;">
            <canvas id="scoreDistributionChart"></canvas>
        </div>
    </div>
</div>

<!-- Tables Section -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8 fade-in">
    <!-- Top Sellers -->
    <div class="pro-card rounded-lg p-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">فروشندگان برتر</h3>
            <div class="icon-box warning w-10 h-10">
                <i class="fas fa-trophy"></i>
            </div>
        </div>
        <div id="top-sellers">
            <!-- توسط JavaScript پر می‌شود -->
        </div>
    </div>

    <!-- Top Customers -->
    <div class="pro-card rounded-lg p-6">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">مشتریان فعال</h3>
            <div class="icon-box info w-10 h-10">
                <i class="fas fa-building"></i>
            </div>
        </div>
        <div id="top-customers" class="space-y-2">
            <!-- توسط JavaScript پر می‌شود -->
        </div>
    </div>

    <!-- Quick Stats -->
    <div class="pro-card rounded-lg p-6 bg-gradient-to-br from-blue-600 to-indigo-600 text-white">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">دسترسی سریع</h3>
            <div class="icon-box white w-10 h-10">
                <i class="fas fa-bolt"></i>
            </div>
        </div>
        <div class="space-y-3">
            <a href="{{ url_for('main.sales_analysis') }}" class="block bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg p-3 transition">
                <div class="flex items-center gap-3">
                    <i class="fas fa-chart-line"></i>
                    <span>تحلیل فروش جدید</span>
                </div>
            </a>
            <a href="{{ url_for('referral.referral_page') }}" class="block bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg p-3 transition">
                <div class="flex items-center gap-3">
                    <i class="fas fa-diagram-project"></i>
                    <span>تحلیل ارجاعات جدید</span>
                </div>
            </a>
            <a href="{{ url_for('main.history') }}" class="block bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg p-3 transition">
                <div class="flex items-center gap-3">
                    <i class="fas fa-history"></i>
                    <span>مشاهده تاریخچه</span>
                </div>
            </a>
        </div>
    </div>
</div>

<!-- Recent Activities -->
<div class="pro-card rounded-lg p-6 fade-in">
    <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold">فعالیت‌های اخیر</h3>
        <a href="{{ url_for('main.history') }}" class="text-blue-600 hover:text-blue-800 text-sm flex items-center gap-1">
            مشاهده همه
            <i class="fas fa-arrow-left"></i>
        </a>
    </div>
    
    <div class="overflow-x-auto">
        <table class="data-table" id="recent-activities">
            <thead>
                <tr>
                    <th>نوع فعالیت</th>
                    <th>کاربر</th>
                    <th>تاریخ</th>
                    <th>نتیجه</th>
                </tr>
            </thead>
            <tbody>
                <!-- توسط JavaScript پر می‌شود -->
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- اینجا app.js رو لود نمی‌کنیم -->
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='dashboard.js') }}"></script>
{% endblock %}