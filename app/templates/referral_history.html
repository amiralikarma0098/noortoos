{% extends "base.html" %}

{% block title %}ØªØ§Ø±ÛŒØ®Ú†Ù‡ ØªØ­Ù„ÛŒÙ„ÛŒ Ø§Ø±Ø¬Ø§Ø¹ÛŒØ§Øª - Ù†ÙˆØ± ØªÙˆØ³{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary: #1e3a5f;
        --primary-dark: #0f2b4a;
        --primary-light: #2b4c7c;
    }
    
    body {
        background: #f5f7fa;
        color: #1f2937;
    }
    
    .glass-card {
        background: white;
        border: 1px solid #e5e7eb;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        border-radius: 1.5rem;
    }
    
    .stat-card {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 1rem;
        padding: 1.25rem;
        transition: all 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 24px rgba(30, 58, 95, 0.1);
        border-color: var(--primary-light);
    }
    
    .table-row-hover:hover {
        background: rgba(30, 58, 95, 0.02);
    }
    
    .trend-up { color: #059669; }
    .trend-down { color: #b91c1c; }
    .trend-stable { color: #d97706; }
    
    .gradient-text {
        color: var(--primary);
        font-weight: 700;
    }
    
    /* Table Styles */
    .data-table th {
        background: #f9fafb;
        color: var(--text-secondary);
        font-weight: 600;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.025em;
        padding: 1rem;
        border-bottom: 2px solid #e5e7eb;
    }
    
    .data-table td {
        padding: 1rem;
        border-bottom: 1px solid #e5e7eb;
        font-size: 0.95rem;
    }
    
    /* Button Styles */
    .btn-excel {
        background: #059669;
        color: white;
        transition: all 0.3s ease;
    }
    
    .btn-excel:hover {
        background: #047857;
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(5, 150, 105, 0.2);
    }
    
    .btn-refresh {
        background: var(--primary);
        color: white;
        transition: all 0.3s ease;
    }
    
    .btn-refresh:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 8px 16px rgba(30, 58, 95, 0.2);
    }
    
    /* Filter Inputs */
    .filter-input {
        border: 1px solid #e5e7eb;
        border-radius: 0.75rem;
        padding: 0.625rem 1rem;
        background: white;
        transition: all 0.3s ease;
        width: 100%;
    }
    
    .filter-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.1);
    }
    
    .filter-select {
        border: 1px solid #e5e7eb;
        border-radius: 0.75rem;
        padding: 0.625rem 1rem;
        background: white;
        transition: all 0.3s ease;
        width: 100%;
        cursor: pointer;
    }
    
    .filter-select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.1);
    }
    
    /* Pagination */
    .pagination-btn {
        background: var(--primary);
        color: white;
        padding: 0.5rem 1.25rem;
        border-radius: 0.75rem;
        transition: all 0.3s ease;
        font-weight: 500;
    }
    
    .pagination-btn:hover:not(:disabled) {
        background: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(30, 58, 95, 0.2);
    }
    
    .pagination-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    /* Status Badges */
    .status-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    .status-high {
        background: rgba(5, 150, 105, 0.1);
        color: #059669;
    }
    
    .status-medium {
        background: rgba(217, 119, 6, 0.1);
        color: #d97706;
    }
    
    .status-low {
        background: rgba(185, 28, 28, 0.1);
        color: #b91c1c;
    }
    
    /* Health Score */
    .health-high {
        background: rgba(5, 150, 105, 0.1);
        color: #059669;
    }
    
    .health-medium {
        background: rgba(217, 119, 6, 0.1);
        color: #d97706;
    }
    
    .health-low {
        background: rgba(185, 28, 28, 0.1);
        color: #b91c1c;
    }
    
    /* Risk Badge */
    .risk-high {
        background: #b91c1c;
        color: white;
    }
    
    .risk-medium {
        background: #d97706;
        color: white;
    }
    
    .risk-low {
        background: #6b7280;
        color: white;
    }
    
    /* Action Buttons */
    .action-btn {
        padding: 0.5rem;
        border-radius: 0.5rem;
        transition: all 0.2s ease;
        color: var(--text-secondary);
    }
    
    .action-btn:hover {
        background: rgba(30, 58, 95, 0.1);
        color: var(--primary);
        transform: scale(1.1);
    }
    
    /* Modal */
    .modal-content {
        background: white;
        border-radius: 2rem;
        max-width: 80rem;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
    }
    
    .modal-header {
        position: sticky;
        top: 0;
        background: white;
        border-bottom: 2px solid #e5e7eb;
        padding: 1.5rem 2rem;
        z-index: 10;
        border-radius: 2rem 2rem 0 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Ø¹Ù†ÙˆØ§Ù† Ùˆ Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ -->
    <div class="glass-card rounded-3xl p-8 mb-8">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8">
            <h2 class="text-2xl md:text-3xl font-bold text-primary">ğŸ“‹ ØªØ§Ø±ÛŒØ®Ú†Ù‡ ØªØ­Ù„ÛŒÙ„ÛŒ Ø§Ø±Ø¬Ø§Ø¹ÛŒØ§Øª</h2>
            <div class="flex flex-wrap gap-3">
                <button onclick="exportAllData()" class="btn-excel px-6 py-3 rounded-xl transition flex items-center gap-2 text-sm md:text-base">
                    <i class="fas fa-file-excel"></i>
                    <span class="hidden sm:inline">Ø®Ø±ÙˆØ¬ÛŒ Excel</span>
                </button>
                <button onclick="refreshData()" class="btn-refresh px-6 py-3 rounded-xl transition flex items-center gap-2 text-sm md:text-base">
                    <i class="fas fa-sync-alt"></i>
                    <span class="hidden sm:inline">Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</span>
                </button>
            </div>
        </div>

        <!-- Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø±ÛŒ Ú©Ù„ÛŒ -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8" id="overall-stats">
            <!-- Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
        </div>

        <!-- ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Ø¬Ø³ØªØ¬Ùˆ</label>
                <input type="text" id="search-input" placeholder="Ù†Ø§Ù… ÙØ§ÛŒÙ„..." class="filter-input">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Ù†Ø±Ø® Ù…ÙˆÙÙ‚ÛŒØª</label>
                <select id="success-rate-filter" class="filter-select">
                    <option value="all">Ù‡Ù…Ù‡</option>
                    <option value="high">Ø¨Ø§Ù„Ø§ÛŒ Û·Û°Ùª</option>
                    <option value="medium">ÛµÛ°-Û·Û°Ùª</option>
                    <option value="low">Ø²ÛŒØ± ÛµÛ°Ùª</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ÙˆØ¶Ø¹ÛŒØª Ú¯Ù„ÙˆÚ¯Ø§Ù‡</label>
                <select id="bottleneck-filter" class="filter-select">
                    <option value="all">Ù‡Ù…Ù‡</option>
                    <option value="has-bottleneck">Ø¯Ø§Ø±Ø§ÛŒ Ú¯Ù„ÙˆÚ¯Ø§Ù‡</option>
                    <option value="no-bottleneck">Ø¨Ø¯ÙˆÙ† Ú¯Ù„ÙˆÚ¯Ø§Ù‡</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Ø§Ø² ØªØ§Ø±ÛŒØ®</label>
                <input type="date" id="date-from" class="filter-input">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ØªØ§ ØªØ§Ø±ÛŒØ®</label>
                <input type="date" id="date-to" class="filter-input">
            </div>
        </div>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ ØªØ§Ø±ÛŒØ®Ú†Ù‡ -->
    <div class="glass-card rounded-3xl p-8">
        <div class="overflow-x-auto">
            <table class="w-full data-table">
                <thead>
                    <tr>
                        <th class="text-right">Ø±Ø¯ÛŒÙ</th>
                        <th class="text-right">Ù†Ø§Ù… ÙØ§ÛŒÙ„</th>
                        <th class="text-right">ØªØ§Ø±ÛŒØ® ØªØ­Ù„ÛŒÙ„</th>
                        <th class="text-center">Ú©Ù„ Ø§Ø±Ø¬Ø§Ø¹Ø§Øª</th>
                        <th class="text-center">Ø§ØªÙ…Ø§Ù… ÛŒØ§ÙØªÙ‡</th>
                        <th class="text-center">Ø¯Ø±ØµØ¯ Ù…ÙˆÙÙ‚ÛŒØª</th>
                        <th class="text-center">Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø´Ø¯Ù‡</th>
                        <th class="text-center">Ú¯Ù„ÙˆÚ¯Ø§Ù‡ Ø§ØµÙ„ÛŒ</th>
                        <th class="text-center">Ø§Ù…ØªÛŒØ§Ø² Ø³Ù„Ø§Ù…Øª</th>
                        <th class="text-center">Ø±ÛŒØ³Ú©â€ŒÙ‡Ø§</th>
                        <th class="text-center">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                    </tr>
                </thead>
                <tbody id="history-table-body">
                    <!-- Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
                </tbody>
            </table>
        </div>

        <!-- ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ -->
        <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-6">
            <div class="text-sm text-gray-600" id="pagination-info"></div>
            <div class="flex gap-2">
                <button id="prev-page" class="pagination-btn" disabled>Ù‚Ø¨Ù„ÛŒ</button>
                <button id="next-page" class="pagination-btn" disabled>Ø¨Ø¹Ø¯ÛŒ</button>
            </div>
        </div>
    </div>
</div>

<!-- Ù…ÙˆØ¯Ø§Ù„ Ø¬Ø²Ø¦ÛŒØ§Øª -->
<div id="detail-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 overflow-y-auto p-4">
    <div class="modal-content">
        <div class="modal-header flex justify-between items-center">
            <h3 class="text-xl md:text-2xl font-bold flex items-center gap-3">
                <i class="fas fa-chart-line text-primary"></i>
                Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ØªØ­Ù„ÛŒÙ„ÛŒ Ú©Ø§Ù…Ù„
            </h3>
            <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 transition">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>
        <div id="modal-content" class="p-6 space-y-6">
            <!-- Ù…Ø­ØªÙˆØ§ Ø¨Ø§ JS Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='referral_history.js') }}"></script>
{% endblock %}